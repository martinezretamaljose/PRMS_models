shacs <- c(4,1,2,3)
shac <- shacs[i]
shac_d <- shac + 1
hru <- c(1:4) + 4*(shac-1)
hru_d <- hru + 1
simulado <- data.frame(mon_serie[,1],rowMeans(mon_serie[,hru_d]))
observado <- data.frame(obs_serie[,c(1,shac_d)])
View(simulado)
View(sim_serie)
View(observado)
obs_serie <- read_xlsx(file.path(main,'recarga_mensual_cb.xlsx'))
obs_serie <- as.data.frame(obs_serie)
sim_serie <- read_xlsx(file.path(prms_dir,'recharge_mm.xlsx'))
sim_serie <- as.data.frame(sim_serie)
sim_serie[,-1] <- sim_serie[,-1]
sim_serie[,1] <- substr(sim_serie[,1],1,7)
mon_serie <- aggregate(sim_serie[,-1],list(sim_serie[,1]),sum)
mon_serie[,1] <- paste0(mon_serie[,1],"-15")
shacs <- c(4,1,2,3)
shac <- shacs[i]
shac_d <- shac + 1
hru <- c(1:4) + 4*(shac-1)
hru_d <- hru + 1
simulado <- data.frame(mon_serie[,1],rowMeans(mon_serie[,hru_d]))
observado <- data.frame(obs_serie[,c(1,shac_d)])
dias <- seq(as.Date("1991-01-01"),
as.Date("2019-12-31"),
1)
dias <- unique(substr(dias,1,8))
dias <- seq(as.Date("1991-01-01"),
as.Date("2019-12-31"),
1)
dias <- paste0(unique(substr(dias,1,8)),"-15")
dias <- seq(as.Date("1991-01-01"),
as.Date("2019-12-31"),
1)
dias <- paste0(unique(substr(dias,1,8)),"15")
dias <- seq(as.Date("1991-01-01"),
as.Date("2019-12-31"),
1)
dias <- as.Date(paste0(unique(substr(dias,1,8)),"15"))
shacs <- c(4,1,2,3)
shac <- shacs[i]
shac_d <- shac + 1
hru <- c(1:4) + 4*(shac-1)
hru_d <- hru + 1
simulado <- data.frame(mon_serie[,1],rowMeans(mon_serie[,hru_d]))
observado <- data.frame(obs_serie[,c(1,shac_d)])
observado$Group.1 %in% dias
simulado <- simulado[which(simulado[,1] %in% dias),]
observado <- observado[which(observado[,1] %in% dias),]
resumen <- dataframe(observado,simulado[,2])
resumen <- data.frame(observado,simulado[,2])
View(resumen)
rmes <- as.data.frame(matrix(0,ncol=7,nrow=12))
rmes[,1] <- seq(1:12)
tstep <- as.numeric(substr(resumen[,1],6,7))
t=1
dfloc <- subset(resumen,tstep==t)
View(dfloc)
colnames(resumen) <- c("date","obs","sim")
View(resumen)
dfloc <- subset(resumen,tstep==t)
obs_20 <- quantile(dfloc$obs,0.2)
obs_50 <- quantile(dfloc$obs,0.5)
obs_80 <- quantile(dfloc$obs,0.8)
sim_20 <- quantile(dfloc$sim,0.2)
sim_50 <- quantile(dfloc$sim,0.5)
sim_80 <- quantile(dfloc$sim,0.8)
for (t in 1:12){
dfloc <- subset(resumen,tstep==t)
obs_20 <- quantile(dfloc$obs,0.2)
obs_50 <- quantile(dfloc$obs,0.5)
obs_80 <- quantile(dfloc$obs,0.8)
sim_20 <- quantile(dfloc$sim,0.2)
sim_50 <- quantile(dfloc$sim,0.5)
sim_80 <- quantile(dfloc$sim,0.8)
rmes[i,2] <- obs_20
rmes[i,3] <- obs_50
rmes[i,4] <- obs_80
rmes[i,5] <- sim_20
rmes[i,6] <- sim_50
rmes[i,7] <- sim_80
}
View(rmes)
for (t in 1:12){
dfloc <- subset(resumen,tstep==t)
obs_20 <- quantile(dfloc$obs,0.2)
obs_50 <- quantile(dfloc$obs,0.5)
obs_80 <- quantile(dfloc$obs,0.8)
sim_20 <- quantile(dfloc$sim,0.2)
sim_50 <- quantile(dfloc$sim,0.5)
sim_80 <- quantile(dfloc$sim,0.8)
rmes[t,2] <- obs_20
rmes[t,3] <- obs_50
rmes[t,4] <- obs_80
rmes[t,5] <- sim_20
rmes[t,6] <- sim_50
rmes[t,7] <- sim_80
}
rmax <- max(resumen[,-1])
plot(resumen$obs~resumen$date,col=NA,xaxt='n',xlab=NA,ylab=unit,
main=paste0(name,' - Daily Series @ SHAC ',z))
plot(resumen$obs~resumen$date,col=NA,xaxt='n',xlab=NA,ylab=unit,
main=paste0('Recharge - Daily Series @ SHAC ',z))
plot(resumen$obs~resumen$date,col=NA,xaxt='n',xlab=NA,ylab=unit,
main=paste0('Recharge - Daily Series @ SHAC ',shac))
plot(resumen$obs~resumen$date,col=NA,xaxt='n',xlab=NA,ylab="[mm/month]",
main=paste0('Recharge - Daily Series @ SHAC ',shac))
View(resumen)
plot(resumen$obs~resumen$date,col=NA,xaxt='n',xlab=NA,ylab="[mm/month]",
main=paste0('Recharge - Daily Series @ SHAC ',shac))
plot(resumen$obs~resumen$date)
shac <- shacs[i]
shac_d <- shac + 1
hru <- c(1:4) + 4*(shac-1)
hru_d <- hru + 1
simulado <- data.frame(mon_serie[,1],rowMeans(mon_serie[,hru_d]))
simulado <- simulado[which(simulado[,1] %in% dias),]
observado <- data.frame(obs_serie[,c(1,shac_d)])
observado <- observado[which(observado[,1] %in% dias),]
resumen <- data.frame(observado,simulado[,2])
colnames(resumen) <- c("date","obs","sim")
tstep <- as.numeric(substr(resumen[,1],6,7))
rmes <- as.data.frame(matrix(0,ncol=7,nrow=12))
rmes[,1] <- seq(1:12)
for (t in 1:12){
dfloc <- subset(resumen,tstep==t)
obs_20 <- quantile(dfloc$obs,0.2)
obs_50 <- quantile(dfloc$obs,0.5)
obs_80 <- quantile(dfloc$obs,0.8)
sim_20 <- quantile(dfloc$sim,0.2)
sim_50 <- quantile(dfloc$sim,0.5)
sim_80 <- quantile(dfloc$sim,0.8)
rmes[t,2] <- obs_20
rmes[t,3] <- obs_50
rmes[t,4] <- obs_80
rmes[t,5] <- sim_20
rmes[t,6] <- sim_50
rmes[t,7] <- sim_80
}
rmax <- max(resumen[,-1])
plot(resumen$obs~resumen$date,
col=NA,xaxt='n',xlab=NA,ylab="[mm/month]",
main=paste0('Recharge - Daily Series @ SHAC ',shac)
)
resumen[,1] <- as.Date(resumen[,1])
plot(resumen$obs~resumen$date,
col=NA,xaxt='n',xlab=NA,ylab="[mm/month]",
main=paste0('Recharge - Daily Series @ SHAC ',shac)
)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
axis(1,at=as.numeric(year_ticks),labels = uniyr,las=2,font=2)
plot(resumen$obs~resumen$date,
col=NA,xaxt='n',xlab=NA,ylab="[mm/month]",
main=paste0('Recharge - Monthly Series @ SHAC ',shac)
)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
axis(1,at=as.numeric(year_ticks),labels = uniyr,las=2,font=2)
lines(resumen$obs~resumen$date,lwd=2,
col=rgb(0,0.62,0.451))
lines(resumen$sim~resumen$date,
col=rgb(0.902,0.624,0),lty=4,lwd=3)
plot(resumen$obs~resumen$date,
col=NA,xaxt='n',xlab=NA,ylab="[mm/month]",
main=paste0('Recharge - Monthly Series @ SHAC ',shac)
)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
axis(1,at=as.numeric(year_ticks),labels = uniyr,las=2,font=2)
abline(v=yly_tck,col=rgb(0.7,0.7,0.7),lty=3)
lines(resumen$obs~resumen$date,lwd=4,
col=rgb(0,0.62,0.451,alpha = 0.5))
lines(resumen$sim~resumen$date,
col=rgb(0.902,0.624,0),lwd=2)
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Obs (MF-PEGH)","Sim (PRMS)"),cex=0.85)
year_ticks <- unique(substr(resumen[,1],1,4))
uniyr <- unique(substr(resumen[,1],1,4))
year_ticks <- as.Date(paste0(uniyr,"-07-01"))
axis(1,at=as.numeric(year_ticks),labels = uniyr,las=2,font=2)
plot(resumen$obs~resumen$date,
col=NA,xaxt='n',xlab=NA,ylab="[mm/month]",
main=paste0('Recharge - Monthly Series @ SHAC ',shac)
)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
axis(1,at=as.numeric(year_ticks),labels = uniyr,las=2,font=2)
lines(resumen$obs~resumen$date,lwd=4,
col=rgb(0,0.62,0.451,alpha = 0.5))
lines(resumen$sim~resumen$date,
col=rgb(0.902,0.624,0),lwd=2)
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Obs (MF-PEGH)","Sim (PRMS)"),cex=0.85)
box(lwd=3)
plot(1~1,xlim=c(1,12),ylim=c(0,1.1*max(rmes[,-1])),xaxt='n',xlab=NA,
col=NA,ylab="[m3/s]",font=2,
main=paste0(name,' - Monthly Variation Series @ SHAC ',z))
plot(1~1,xlim=c(1,12),ylim=c(0,1.1*max(rmes[,-1])),xaxt='n',xlab=NA,
col=NA,ylab="[mm/month]",font=2,
main=paste0('Recharge - Monthly Variation Series @ SHAC ',shac))
axis(1,at=seq(1:12),font=2)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
polygon(x=c(rmes[,1],rev(rmes[,1])),
y=c(rmes[,4],rev(rmes[,2])),
border=NA,col=rgb(0,0.62,0.451,alpha=0.4))
lines(rmes[,3]~rmes[,1],lwd=3,col=rgb(0,0.62,0.451))
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Obs (MF-PEGH)","Sim (PRMS)"),cex=0.85)
polygon(x=c(rmes[,1],rev(rmes[,1])),
y=c(rmes[,7],rev(rmes[,5])),
border=NA,col=rgb(0.902,0.624,0,alpha=0.4))
lines(rmes[,6]~rmes[,1],lwd=3,col=rgb(0.902,0.624,0))
for (i in 1:4){
shac <- shacs[i]
shac_d <- shac + 1
hru <- c(1:4) + 4*(shac-1)
hru_d <- hru + 1
simulado <- data.frame(mon_serie[,1],rowMeans(mon_serie[,hru_d]))
simulado <- simulado[which(simulado[,1] %in% dias),]
observado <- data.frame(obs_serie[,c(1,shac_d)])
observado <- observado[which(observado[,1] %in% dias),]
resumen <- data.frame(observado,simulado[,2])
resumen[,1] <- as.Date(resumen[,1])
colnames(resumen) <- c("date","obs","sim")
tstep <- as.numeric(substr(resumen[,1],6,7))
uniyr <- unique(substr(resumen[,1],1,4))
year_ticks <- as.Date(paste0(uniyr,"-07-01"))
rmes <- as.data.frame(matrix(0,ncol=7,nrow=12))
rmes[,1] <- seq(1:12)
for (t in 1:12){
dfloc <- subset(resumen,tstep==t)
obs_20 <- quantile(dfloc$obs,0.2)
obs_50 <- quantile(dfloc$obs,0.5)
obs_80 <- quantile(dfloc$obs,0.8)
sim_20 <- quantile(dfloc$sim,0.2)
sim_50 <- quantile(dfloc$sim,0.5)
sim_80 <- quantile(dfloc$sim,0.8)
rmes[t,2] <- obs_20
rmes[t,3] <- obs_50
rmes[t,4] <- obs_80
rmes[t,5] <- sim_20
rmes[t,6] <- sim_50
rmes[t,7] <- sim_80
}
rmax <- max(resumen[,-1])
nsal <- paste0("RECARGA SHAC ",shac,".png")
png(file.path(prms_dir,nsal),
width=1920,
height=720,
pointsize=18)
par(mfrow=c(1,2))
plot(resumen$obs~resumen$date,
col=NA,xaxt='n',xlab=NA,ylab="[mm/month]",
main=paste0('Recharge - Monthly Series @ SHAC ',shac)
)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
axis(1,at=as.numeric(year_ticks),labels = uniyr,las=2,font=2)
lines(resumen$obs~resumen$date,lwd=4,
col=rgb(0,0.62,0.451,alpha = 0.5))
lines(resumen$sim~resumen$date,
col=rgb(0.902,0.624,0),lwd=2)
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Obs (MF-PEGH)","Sim (PRMS)"),cex=0.85)
box(lwd=3)
plot(1~1,xlim=c(1,12),ylim=c(0,1.1*max(rmes[,-1])),xaxt='n',xlab=NA,
col=NA,ylab="[mm/month]",font=2,
main=paste0('Recharge - Monthly Variation Series @ SHAC ',shac))
axis(1,at=seq(1:12),font=2)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
polygon(x=c(rmes[,1],rev(rmes[,1])),
y=c(rmes[,4],rev(rmes[,2])),
border=NA,col=rgb(0,0.62,0.451,alpha=0.4))
lines(rmes[,3]~rmes[,1],lwd=3,col=rgb(0,0.62,0.451))
polygon(x=c(rmes[,1],rev(rmes[,1])),
y=c(rmes[,7],rev(rmes[,5])),
border=NA,col=rgb(0.902,0.624,0,alpha=0.4))
lines(rmes[,6]~rmes[,1],lwd=3,col=rgb(0.902,0.624,0))
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Obs (MF-PEGH)","Sim (PRMS)"),cex=0.85)
box(lwd=3)
dev.off()
}
library(rstudioapi)
library(zoo)
library(stringr)
library(stringi)
library(readxl)
library(writexl)
rm(list=ls());graphics.off();gc();cat("\f")
main <- dirname(getActiveDocumentContext()$path)
prms_dir <- str_replace(main,'scripts','output/graphics and indicators')
{name <- "Caudal"
unit <- "[m3/s]"
sim_file <- file.path(prms_dir,'seg_outflow_mm.xlsx')
sim_file <- as.data.frame(read_xlsx(sim_file))
sim_file[,1] <- as.Date(sim_file[,1])
sim_file[,-1] <- 0.1*(sim_file[,-1]/35.341)
years <- as.numeric(substr(sim_file[,1],1,4))
sim_file <- sim_file[which(years>1990),]
uniyr <- unique(years)[-1]
year_ticks <- as.Date(paste0(uniyr,"-07-01"))
yly_tck <- as.Date(paste0(unique(years),"-12-31"))
mres <- sim_file
mres[,1] <- substr(mres[,1],1,7)
mres <- aggregate(mres[,-1],list(mres[,1]),mean)
mres[,1] <- as.numeric(substr(mres[,1],6,7))
for (z in 1:7){
zmes <- quantile(mres[,(z+1)],0.5)
zday <- quantile(sim_file[,(z+1)],0.5)
rmes <- as.data.frame(matrix(0,ncol=4,nrow=12))
for (t in 1:12){
ssi <- subset(mres,mres[,1]==t)
rmes[t,1] <- t
rmes[t,2] <- quantile(ssi[,(z+1)],0.2)
rmes[t,3] <- quantile(ssi[,(z+1)],0.5)
rmes[t,4] <- quantile(ssi[,(z+1)],0.8)
}
nsal <- paste0("QMS SHAC ",z,".png")
png(file.path(prms_dir,nsal),
width=1920,
height=720,
pointsize=18)
par(mfrow=c(1,2))
plot(sim_file[,2]~sim_file[,1],col=NA,xaxt='n',xlab=NA,ylab=unit,
main=paste0(name,' - Daily Series @ SHAC ',z))
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
axis(1,at=as.numeric(year_ticks),labels = uniyr,las=2,font=2)
abline(v=yly_tck,col=rgb(0.7,0.7,0.7),lty=3)
lines(sim_file[,2]~sim_file[,1],lwd=2,
col=rgb(0,0.62,0.451))
lines(rep(zmes,length(sim_file[,1]))~sim_file[,1],
col=rgb(0.902,0.624,0),lty=4,lwd=3)
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Daily Series","Global Median"),cex=0.85)
box(lwd=3)
plot(1~1,xlim=c(1,12),ylim=c(0,1.1*max(rmes[,-1])),xaxt='n',xlab=NA,
col=NA,ylab="[m3/s]",font=2,
main=paste0(name,' - Monthly Variation Series @ SHAC ',z))
axis(1,at=seq(1:12),font=2)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
polygon(x=c(rmes[,1],rev(rmes[,1])),
y=c(rmes[,4],rev(rmes[,2])),
border=NA,col=rgb(0,0.62,0.451,alpha=0.4))
lines(rmes[,3]~rmes[,1],lwd=3,col=rgb(0,0.62,0.451))
lines(rep(zmes,length(rmes[,1]))~rmes[,1],
col=rgb(0.902,0.624,0),lty=4,lwd=3)
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Monthly Median","Global Median"),cex=0.85)
box(lwd=3)
dev.off()
}
}
{name <- "Caudal"
unit <- "[m3/s]"
sim_file <- file.path(prms_dir,'seg_outflow_mm.xlsx')
sim_file <- as.data.frame(read_xlsx(sim_file))
sim_file[,1] <- as.Date(sim_file[,1])
sim_file[,-1] <- 1*(sim_file[,-1]/35.341)
years <- as.numeric(substr(sim_file[,1],1,4))
sim_file <- sim_file[which(years>1990),]
uniyr <- unique(years)[-1]
year_ticks <- as.Date(paste0(uniyr,"-07-01"))
yly_tck <- as.Date(paste0(unique(years),"-12-31"))
mres <- sim_file
mres[,1] <- substr(mres[,1],1,7)
mres <- aggregate(mres[,-1],list(mres[,1]),mean)
mres[,1] <- as.numeric(substr(mres[,1],6,7))
for (z in 1:7){
zmes <- quantile(mres[,(z+1)],0.5)
zday <- quantile(sim_file[,(z+1)],0.5)
rmes <- as.data.frame(matrix(0,ncol=4,nrow=12))
for (t in 1:12){
ssi <- subset(mres,mres[,1]==t)
rmes[t,1] <- t
rmes[t,2] <- quantile(ssi[,(z+1)],0.2)
rmes[t,3] <- quantile(ssi[,(z+1)],0.5)
rmes[t,4] <- quantile(ssi[,(z+1)],0.8)
}
nsal <- paste0("QMS SHAC ",z,".png")
png(file.path(prms_dir,nsal),
width=1920,
height=720,
pointsize=18)
par(mfrow=c(1,2))
plot(sim_file[,2]~sim_file[,1],col=NA,xaxt='n',xlab=NA,ylab=unit,
main=paste0(name,' - Daily Series @ SHAC ',z))
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
axis(1,at=as.numeric(year_ticks),labels = uniyr,las=2,font=2)
abline(v=yly_tck,col=rgb(0.7,0.7,0.7),lty=3)
lines(sim_file[,2]~sim_file[,1],lwd=2,
col=rgb(0,0.62,0.451))
lines(rep(zmes,length(sim_file[,1]))~sim_file[,1],
col=rgb(0.902,0.624,0),lty=4,lwd=3)
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Daily Series","Global Median"),cex=0.85)
box(lwd=3)
plot(1~1,xlim=c(1,12),ylim=c(0,1.1*max(rmes[,-1])),xaxt='n',xlab=NA,
col=NA,ylab="[m3/s]",font=2,
main=paste0(name,' - Monthly Variation Series @ SHAC ',z))
axis(1,at=seq(1:12),font=2)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
polygon(x=c(rmes[,1],rev(rmes[,1])),
y=c(rmes[,4],rev(rmes[,2])),
border=NA,col=rgb(0,0.62,0.451,alpha=0.4))
lines(rmes[,3]~rmes[,1],lwd=3,col=rgb(0,0.62,0.451))
lines(rep(zmes,length(rmes[,1]))~rmes[,1],
col=rgb(0.902,0.624,0),lty=4,lwd=3)
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Monthly Median","Global Median"),cex=0.85)
box(lwd=3)
dev.off()
}
}
{name <- "Caudal"
unit <- "[m3/s]"
sim_file <- file.path(prms_dir,'seg_outflow_mm.xlsx')
sim_file <- as.data.frame(read_xlsx(sim_file))
sim_file[,1] <- as.Date(sim_file[,1])
sim_file[,-1] <- (sim_file[,-1]/(35.341*25.4))
years <- as.numeric(substr(sim_file[,1],1,4))
sim_file <- sim_file[which(years>1990),]
uniyr <- unique(years)[-1]
year_ticks <- as.Date(paste0(uniyr,"-07-01"))
yly_tck <- as.Date(paste0(unique(years),"-12-31"))
mres <- sim_file
mres[,1] <- substr(mres[,1],1,7)
mres <- aggregate(mres[,-1],list(mres[,1]),mean)
mres[,1] <- as.numeric(substr(mres[,1],6,7))
for (z in 1:7){
zmes <- quantile(mres[,(z+1)],0.5)
zday <- quantile(sim_file[,(z+1)],0.5)
rmes <- as.data.frame(matrix(0,ncol=4,nrow=12))
for (t in 1:12){
ssi <- subset(mres,mres[,1]==t)
rmes[t,1] <- t
rmes[t,2] <- quantile(ssi[,(z+1)],0.2)
rmes[t,3] <- quantile(ssi[,(z+1)],0.5)
rmes[t,4] <- quantile(ssi[,(z+1)],0.8)
}
nsal <- paste0("QMS SHAC ",z,".png")
png(file.path(prms_dir,nsal),
width=1920,
height=720,
pointsize=18)
par(mfrow=c(1,2))
plot(sim_file[,2]~sim_file[,1],col=NA,xaxt='n',xlab=NA,ylab=unit,
main=paste0(name,' - Daily Series @ SHAC ',z))
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
axis(1,at=as.numeric(year_ticks),labels = uniyr,las=2,font=2)
abline(v=yly_tck,col=rgb(0.7,0.7,0.7),lty=3)
lines(sim_file[,2]~sim_file[,1],lwd=2,
col=rgb(0,0.62,0.451))
lines(rep(zmes,length(sim_file[,1]))~sim_file[,1],
col=rgb(0.902,0.624,0),lty=4,lwd=3)
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Daily Series","Global Median"),cex=0.85)
box(lwd=3)
plot(1~1,xlim=c(1,12),ylim=c(0,1.1*max(rmes[,-1])),xaxt='n',xlab=NA,
col=NA,ylab="[m3/s]",font=2,
main=paste0(name,' - Monthly Variation Series @ SHAC ',z))
axis(1,at=seq(1:12),font=2)
rect(par("usr")[1], par("usr")[3],
par("usr")[2], par("usr")[4],
col = rgb(0.95,0.95,0.95))
grid(nx=NA,ny=NULL,lty=2,col=rgb(0,0,0,alpha = 0.6))
polygon(x=c(rmes[,1],rev(rmes[,1])),
y=c(rmes[,4],rev(rmes[,2])),
border=NA,col=rgb(0,0.62,0.451,alpha=0.4))
lines(rmes[,3]~rmes[,1],lwd=3,col=rgb(0,0.62,0.451))
lines(rep(zmes,length(rmes[,1]))~rmes[,1],
col=rgb(0.902,0.624,0),lty=4,lwd=3)
legend("top",col=c(rgb(0,0.62,0.451),rgb(0.902,0.624,0)),lwd=3,
legend=c("Monthly Median","Global Median"),cex=0.85)
box(lwd=3)
dev.off()
}
}
